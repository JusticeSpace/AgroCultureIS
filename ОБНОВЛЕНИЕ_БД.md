# Инструкция по обновлению базы данных AgroCulture

## Важное обновление безопасности

В последней версии проекта внедрено **SHA256 хеширование паролей** для повышения безопасности.

### Шаг 1: Резервная копия базы данных

Перед обновлением обязательно создайте резервную копию базы данных:

```sql
BACKUP DATABASE [AgroCulture]
TO DISK = 'C:\Backup\AgroCulture_backup.bak'
WITH FORMAT;
```

### Шаг 2: Запуск скрипта обновления

Выполните SQL скрипт `update_passwords.sql` в SQL Server Management Studio:

1. Откройте SQL Server Management Studio
2. Подключитесь к вашему SQL Server
3. Откройте файл `update_passwords.sql`
4. Выполните скрипт (F5)

### Шаг 3: Проверка

После выполнения скрипта все пароли будут обновлены на SHA256 хеши.

**Тестовые учетные записи:**
- **Администратор:** `admin` / `admin`
- **Менеджер:** `manager` / `manager`
- **Гость:** `guest` / `guest`

### Технические детали

**До обновления:**
- Пароли хранились в открытом виде (PasswordHash = "admin")

**После обновления:**
- Пароли хешируются с помощью SHA256
- Пример: "admin" → `8c6976e5b5410415bde908bd4dee15dfb167a9c873fc4bb8a81f6f2ab448a918`

### Важно!

⚠️ **После обновления БД невозможно будет войти со старыми паролями!**

Если вы уже создали пользователей с паролями в старой версии, им потребуется:
1. Сбросить пароль через администратора
2. Или обновить их пароли вручную через SQL

## Дополнительная информация

Для создания нового пользователя с хешированным паролем используйте:
- Интерфейс "Управление сотрудниками" (только для Admin)
- Пароли автоматически хешируются при создании/изменении

## Изменения в коде

Файлы, затронутые обновлением:
- `Services/PasswordHasher.cs` - реализация SHA256 хеширования
- `Services/DatabaseService.cs` - проверка хешей при авторизации
- `ViewModels/StaffViewModel.cs` - хеширование при создании сотрудника
- `Views/ProfilePage.xaml.cs` - хеширование при смене пароля
